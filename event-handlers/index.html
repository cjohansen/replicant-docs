<!DOCTYPE html><html data-theme="dark" lang="en" prefix="og: http://ogp.me/ns#"><head><title>Event handlers</title><meta name="theme-color" content="#202020"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta property="og:title" content="Event handlers"><link href="/a00f586d252b/favicon.ico" rel="icon" type="image/x-icon"><link href="/a00f586d252b/favicon.ico" rel="shortcut icon" type="image/ico"><link href="/a00f586d252b/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/a00f586d252b/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon"><link href="/285191ad6a81/apple-touch-icon.png" rel="icon" type="image/png" sizes="180x180"><link rel="stylesheet" href="/bundles/2e8dfb3c3384/styles.css"></head><body><div class="flex justify-between p-4 items-center"><div class="w-8"><a href="/"><svg style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2" viewBox="0 0 1080 1080" xml:space="preserve"><path d="M876.452 152.555c136.818 12.348 195.668 81.688 192.708 196.198h-87.197c1.569-66.295-16.004-119.066-52.748-157.356-14.398-15.003-31.913-27.882-52.763-38.353v-.489Zm98.715 270.164h87.213c-9.48 55.52-38.53 92.323-91.749 108.344 55.789 39.542 76.849 90.867 66.189 152.957l-44.388 184.981h-86.379l42.751-178.151c.149-.622.278-1.249.386-1.879 9.983-58.16-3.188-108.49-41.722-150.197 36.949-23.921 58.758-61.19 67.282-111.131a29.34 29.34 0 0 0 .417-4.924Z" fill="#4fb348"></path><path d="M757.149 152.309c138.837 11.646 198.514 81.149 195.537 196.444h-88.511c1.643-69.4-17.651-123.977-58.046-162.647-13.679-13.096-29.954-24.431-48.98-33.797Zm101.023 270.41h87.726c-9.475 55.52-38.529 92.323-91.745 108.344 55.785 39.542 76.848 90.867 66.191 152.957l-44.391 184.981h-87.689l42.752-178.151c.149-.622.278-1.249.386-1.879 9.983-58.16-3.188-108.49-41.722-150.197 36.948-23.921 58.758-61.19 67.281-111.131.153-.894.263-1.79.332-2.685h.506c.126-.747.25-1.493.373-2.239Z" fill="#00a29a"></path><path d="M76.208 847.157c-36.752-5.562-64.959-37.32-64.959-75.614 0-42.21 34.269-76.478 76.478-76.478a76.45 76.45 0 0 1 20.676 2.832c32.178 9.028 55.802 38.6 55.802 73.646 0 42.209-34.268 76.478-76.478 76.478-3.915 0-7.761-.295-11.519-.864Zm56.524-262.05a77.324 77.324 0 0 1-6.804.299c-42.209 0-76.478-34.268-76.478-76.478 0-42.209 34.269-76.478 76.478-76.478 13.663 0 26.494 3.591 37.6 9.879 23.204 13.139 38.878 38.053 38.878 66.599 0 39.917-30.647 72.732-69.674 76.179Zm-18.148 84.136 11.77-54.569c58.168-.23 105.321-47.525 105.321-105.746 0-35.555-17.586-67.035-44.526-86.209H828.11c-9.475 55.52-38.529 92.323-91.745 108.344 55.784 39.542 76.848 90.867 66.191 152.957l-44.391 184.981H539.756l34.836-151.189c13.135-57.004-4.455-118.062-91.882-118.062H353.796l-71.217 274.677H112.245c46.557-11.07 81.229-52.96 81.229-102.884 0-49.085-33.515-90.403-78.89-102.3Zm-1.803-330.67 117.483-187.485h389.845c152.584 6.696 217.9 77.175 214.789 197.665H178.595v-10.18h-65.814Z" fill="#0086ff"></path></svg></a></div><div class="flex items-center gap-4 text-sm"><a class="hover:underline" href="/learn/">Learn</a><a class="hover:underline" href="https://cljdoc.org/d/no.cjohansen/replicant/">API Reference</a><div class="w-6"><a href="https://clojurians.slack.com/archives/C06JZ4X334N" title="Replicant on the Clojurians Slack"><svg style="display: inline-block; line-height: 1;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><path d="M80,56h24a0,0,0,0,1,0,0v72a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24V80A24,24,0,0,1,80,56Z" transform="translate(184 24) rotate(90)" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M128,80H104A24,24,0,0,1,80,56h0a24,24,0,0,1,24-24h0a24,24,0,0,1,24,24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M152,32h24a0,0,0,0,1,0,0v72a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24V56a24,24,0,0,1,24-24Z" transform="translate(304 160) rotate(-180)" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M176,128V104a24,24,0,0,1,24-24h0a24,24,0,0,1,24,24h0a24,24,0,0,1-24,24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M176,104h24a0,0,0,0,1,0,0v72a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24V128a24,24,0,0,1,24-24Z" transform="translate(24 328) rotate(-90)" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M128,176h24a24,24,0,0,1,24,24h0a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M104,128h24a0,0,0,0,1,0,0v72a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24V152a24,24,0,0,1,24-24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M80,128v24a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24h0a24,24,0,0,1,24-24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path></svg></a></div><div class="w-6"><a href="https://github.com/cjohansen/replicant" title="Replicant on Github"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"></path></svg></a></div></div></div><div class="p-4 bg-base-200 items-center flex flex-row gap-4 sticky top-0 z-10"><button popovertarget="menu"><svg style="display: inline-block; line-height: 1; height: 24; width: 24;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><line stroke="currentColor" fill="none" stroke-linejoin="round" y1="128" stroke-linecap="round" stroke-width="16" x1="40" y2="128" x2="216"></line><line stroke="currentColor" fill="none" stroke-linejoin="round" y1="64" stroke-linecap="round" stroke-width="16" x1="40" y2="64" x2="216"></line><line stroke="currentColor" fill="none" stroke-linejoin="round" y1="192" stroke-linecap="round" stroke-width="16" x1="40" y2="192" x2="216"></line></svg></button><div id="menu" class="bg-base-200 m-0 px-0 absolute h-full" popover="auto"><aside class="basis-60 shrink-0"><h3 class="text-whitish mb-2 ml-4">Guides</h3><nav class="mb-8"><ol><li><a class="menu-item" href="/hiccup/">Hiccup<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><span class="menu-item menu-item-selected">Event handlers<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></span></li><li><a class="menu-item" href="/life-cycle-hooks/">Life-cycle hooks<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/keys/">Keys<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/nil/">Explicit nils<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/alias/">Aliases<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li></ol></nav><h3 class="text-whitish mb-2 ml-4">Tutorials</h3><nav class="mb-8"><ol><li><a class="menu-item" href="/tutorials/tic-tac-toe/">Tic-Tac-Toe<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/routing/">Data-driven routing<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/state-atom/">State management with atoms<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/state-datascript/">State management with Datascript<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/network/">Backend APIs and network<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/network-reads/">Data-driven queries<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/network-writes/">Data-driven commands<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/tic-tac-toe-alias/">Tic-Tac-Toe with aliases<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/i18n-alias/">Alias powered i18n<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/sortable-table/">A sortable table alias<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li></ol></nav><h3 class="text-whitish mb-2 ml-4">Articles</h3><nav class="mb-8"><ol><li><a class="menu-item" href="/top-down/">Top-down rendering<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/learn/">Learn Replicant<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li></ol></nav></aside></div>Guide: Event handlers</div><main class="mt-8 mb-16 mx-4 md:mx-0 fullscreen"><h1 class="h1 dark:text-whitish section-md">Event handlers</h1><div class="prose mt-4 section-md"><p>All event handlers go in a map under the <code>:on</code> attribute key. Event handler
names are the same ones as in the browser. Replicant does not keep a list of
valid names to use – whatever you pass it, it will pass to <code>addEventListener</code>:</p>
</div><div class="lg:flex items-stretch rounded-md border border-neutral section-md my-6 bg-base-100"><pre class="codehilite codehilite"><span class="code-title">Hiccup</span><code class="clj"><span></span><span class="p">[</span><span class="ss">:button</span>
 <span class="p">{</span><span class="ss">:on</span> <span class="p">{</span><span class="ss">:click</span>
       <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">e</span><span class="p">]</span>
         <span class="p">(</span><span class="nf">js/alert</span> <span class="s">"Hello!"</span><span class="p">))}}</span>
 <span class="s">"Click it"</span><span class="p">]</span>
</code></pre><div class="flex flex-col flex-1 flex-col justify-center flex"><span class="code-title">Result</span><div class="p-4 flex items-center grow" data-example-ns="repliweb.demos.oneoffs" data-example-fn="button-click-example"></div></div></div><div class="prose mt-4 section-md"><p>Replicant does no special handling of the event handler function: it will behave
exactly as if you added it with <code>.addEventListener</code>. That means that <code>e</code> is a
plain old JavaScript <code>Event</code> object.</p>
<h2>Functions are not data</h2>
<p>One problem with event handlers is that functions are not data. This is
unfortunate for a few reasons.</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">render-like-button</span> <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">video</span> <span class="nv">user</span><span class="p">]}]</span>
  <span class="p">[</span><span class="ss">:button.btn</span>
   <span class="p">{</span><span class="ss">:on</span> <span class="p">{</span><span class="ss">:click</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">e</span><span class="p">]</span>
                  <span class="p">(</span><span class="nf">like-video</span> <span class="nv">video</span> <span class="nv">user</span><span class="p">))}}</span>
   <span class="s">"Like"</span><span class="p">])</span>
</code></pre>
<p>This function will produce a new event handler function every time it’s called.
This will cause Replicant to replace the event handler on every render, even
when it’s functionally the same.</p>
<p>Functions not being data also means that you can’t serialize the UI, limiting
your options.</p>
<p><a id="data"></a></p>
<h2>Event handlers as data</h2>
<p>Replicant offers a solution to this problem by allowing event handlers to be
expressed as data. To use this feature, you must first register a global event
handler. Whenever Replicant encounters an event handler that is not a function,
it will pass the event handler data to the global handler function instead.</p>
<p>The global handler only needs to be registered once:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">replicant.dom</span> <span class="ss">:as</span> <span class="nv">r</span><span class="p">])</span>

<span class="p">(</span><span class="nf">r/set-dispatch!</span>
 <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">event-data</span> <span class="nv">handler-data</span><span class="p">]</span>
   <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">= </span><span class="ss">:replicant.trigger/dom-event</span>
            <span class="p">(</span><span class="ss">:replicant/trigger</span> <span class="nv">event-data</span><span class="p">))</span>
     <span class="p">(</span><span class="nb">println </span><span class="s">"Event triggered!"</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">println </span><span class="s">"Event:"</span> <span class="p">(</span><span class="ss">:replicant/dom-event</span> <span class="nv">event-data</span><span class="p">))</span>
     <span class="p">(</span><span class="nb">println </span><span class="s">"Node:"</span> <span class="p">(</span><span class="ss">:replicant/node</span> <span class="nv">event-data</span><span class="p">))</span>
     <span class="p">(</span><span class="nb">println </span><span class="s">"Handler data:"</span> <span class="nv">handler-data</span><span class="p">))))</span>
</code></pre>
<p>Now you can express event handlers with arbitrary data:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">render-like-button</span> <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">video</span> <span class="nv">user</span><span class="p">]}]</span>
  <span class="p">[</span><span class="ss">:button.btn</span>
   <span class="p">{</span><span class="ss">:on</span> <span class="p">{</span><span class="ss">:click</span> <span class="p">[</span><span class="ss">:like-video</span> <span class="nv">video</span> <span class="nv">user</span><span class="p">]}}</span>
   <span class="s">"Like"</span><span class="p">])</span>
</code></pre>
<p>When clicking this button, the global handler will print the following:</p>
<pre class="codehilite"><code><span></span>Event triggered!
Event: #object[PointerEvent [object PointerEvent]]
Node: #object[HTMLButtonElement [object HTMLButtonElement]]
Handler data: [:like-video {:video/id v7c8b} {:user/id u23f4}]
</code></pre>
<p>As you can see, the event handler data is passed through as is. Replicant infers
no meaning from this data, it is up to you to define the desired behavior.</p>
<h3>The trigger</h3>
<p>In the above example, <code>:replicant/trigger</code> was checked before dispatching the
action. This key can have one of two values:</p>
<ul>
<li><code>:replicant.trigger/dom-event</code> for DOM events</li>
<li><code>:replicant.trigger/life-cycle</code> for <a href="/life-cycle-hooks/">life-cycle hooks</a></li>
</ul>
<p>When it has the value <code>:replicant.trigger/life-cycle</code>, the dispatch function
will only be called with one argument.</p>
<p><a id="action-dispatch"></a></p>
<h2>The action dispatch pattern</h2>
<p>Here’s one way to use data for event handlers. In response to an event from our
app, we want one of a few things to happen. We can describe an action with a
vector containing a keyword naming the type of action, and optional additional
arguments:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="c1">;; Trigger an alert</span>
<span class="p">[</span><span class="ss">:action/alert</span> <span class="s">"Hello world!"</span><span class="p">]</span>

<span class="c1">;; Issue a command to the backend</span>
<span class="p">[</span><span class="ss">:action/issue-command</span>
 <span class="p">{</span><span class="ss">:command/kind</span> <span class="ss">:video/like-video</span>
  <span class="ss">:command/data</span> <span class="p">{</span><span class="ss">:video/id</span> <span class="nv">v7c8b</span>
                 <span class="ss">:user/id</span> <span class="nv">u23f4</span><span class="p">}}]</span>
</code></pre>
<p>It can be quite handy to execute multiple actions for one event, so the contract
for our event handler data will be a collection of these action tuples:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">render-like-button</span> <span class="p">[</span><span class="nv">state</span><span class="p">]</span>
  <span class="p">[</span><span class="ss">:button</span>
   <span class="p">{</span><span class="ss">:on</span>
    <span class="p">{</span><span class="ss">:click</span> <span class="p">[[</span><span class="ss">:action/alert</span> <span class="s">"You clicked!"</span><span class="p">]</span>
             <span class="p">[</span><span class="ss">:action/issue-command</span>
              <span class="p">{</span><span class="ss">:command/kind</span> <span class="ss">:video/like-video</span>
               <span class="ss">:command/data</span> <span class="p">{</span><span class="ss">:video/id</span> <span class="nv">v7c8b</span>
                              <span class="ss">:user/id</span> <span class="nv">u23f4</span><span class="p">}}]]}}</span>
   <span class="s">"Like it"</span><span class="p">])</span>
</code></pre>
<p>To make this work, we will need a dispatching function:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">execute-actions</span> <span class="p">[</span><span class="nv">actions</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">doseq </span><span class="p">[[</span><span class="nv">action</span> <span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="nv">actions</span><span class="p">]</span>
    <span class="p">(</span><span class="nf">case</span> <span class="nv">action</span>
      <span class="ss">:action/alert</span>
      <span class="p">(</span><span class="nf">js/alert</span> <span class="p">(</span><span class="nb">apply str </span><span class="nv">args</span><span class="p">))</span>

      <span class="ss">:action/issue-command</span>
      <span class="p">(</span><span class="nb">apply </span><span class="nv">backend/issue-command</span> <span class="nv">args</span><span class="p">))))</span>
</code></pre>
<p>Finally, hook it up to Replicant:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">replicant.dom</span> <span class="ss">:as</span> <span class="nv">r</span><span class="p">])</span>

<span class="p">(</span><span class="nf">r/set-dispatch!</span>
 <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">event-data</span> <span class="nv">actions</span><span class="p">]</span>
   <span class="p">(</span><span class="nf">execute-actions</span> <span class="nv">actions</span><span class="p">)))</span>
</code></pre>
<p>And that’s it, a bare-bones action dispatching system for your app. You can make
this as sophisticated as you want. Or you could use <code>set-dispatch!</code> to hook into
a library that provides similar functionality. Your imagination is the limit.</p>
<h3>Event data</h3>
<p>One thing missing from the action dispatch system is access to values from the
event object. Let’s say you wanted to access text in an input field. How can you
do that with data? With placeholders!</p>
<p><code>clojure.walk</code> is perfect for tiny data-driven templating systems. We’ll use
<code>:event/target.value</code> as a placeholder for the event’s target node’s <code>value</code>
property. Before we run through the actions and dispatch them, we will find any
placeholders and replace them with the current value:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">clojure.walk</span> <span class="ss">:as</span> <span class="nv">walk</span><span class="p">])</span>
<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">replicant.dom</span> <span class="ss">:as</span> <span class="nv">r</span><span class="p">])</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">interpolate-actions</span> <span class="p">[</span><span class="nv">event</span> <span class="nv">actions</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">walk/postwalk</span>
   <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span><span class="p">]</span>
     <span class="p">(</span><span class="nf">case</span> <span class="nv">x</span>
       <span class="ss">:event/target.value</span> <span class="p">(</span><span class="nb">.. </span><span class="nv">event</span> <span class="nv">-target</span> <span class="nv">-value</span><span class="p">)</span>
       <span class="c1">;; Add more cases as needed</span>
       <span class="nv">x</span><span class="p">))</span>
   <span class="nv">actions</span><span class="p">))</span>

<span class="p">(</span><span class="nf">r/set-dispatch!</span>
 <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">event-data</span> <span class="nv">actions</span><span class="p">]</span>
   <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="nv">actions</span>
        <span class="p">(</span><span class="nf">interpolate-actions</span>
         <span class="p">(</span><span class="ss">:replicant/dom-event</span> <span class="nv">event-data</span><span class="p">))</span>
        <span class="nv">execute-actions</span><span class="p">)))</span>
</code></pre>
<p>Now this will prompt you with what you wrote on leaving the input field.</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">[</span><span class="ss">:input</span>
 <span class="p">{</span><span class="ss">:on</span>
  <span class="p">{</span><span class="ss">:blur</span>
   <span class="p">[[</span><span class="ss">:action/alert</span> <span class="s">"You typed: "</span> <span class="ss">:event/target.value</span><span class="p">]]}}]</span>
</code></pre>
</div></main><script type="text/javascript" src="/bundles/d399b4851ce7/app.js"></script></body></html>