<!DOCTYPE html><html data-theme="dark" lang="en" prefix="og: http://ogp.me/ns#"><head><title>Alias powered i18n</title><meta name="theme-color" content="#202020"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta property="og:title" content="Alias powered i18n"><link href="/a00f586d252b/favicon.ico" rel="icon" type="image/x-icon"><link href="/a00f586d252b/favicon.ico" rel="shortcut icon" type="image/ico"><link href="/a00f586d252b/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/a00f586d252b/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon"><link href="/285191ad6a81/apple-touch-icon.png" rel="icon" type="image/png" sizes="180x180"><link rel="stylesheet" href="/bundles/2e8dfb3c3384/styles.css"></head><body><div class="flex justify-between p-4 items-center"><div class="w-8"><a href="/"><svg style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2" viewBox="0 0 1080 1080" xml:space="preserve"><path d="M876.452 152.555c136.818 12.348 195.668 81.688 192.708 196.198h-87.197c1.569-66.295-16.004-119.066-52.748-157.356-14.398-15.003-31.913-27.882-52.763-38.353v-.489Zm98.715 270.164h87.213c-9.48 55.52-38.53 92.323-91.749 108.344 55.789 39.542 76.849 90.867 66.189 152.957l-44.388 184.981h-86.379l42.751-178.151c.149-.622.278-1.249.386-1.879 9.983-58.16-3.188-108.49-41.722-150.197 36.949-23.921 58.758-61.19 67.282-111.131a29.34 29.34 0 0 0 .417-4.924Z" fill="#4fb348"></path><path d="M757.149 152.309c138.837 11.646 198.514 81.149 195.537 196.444h-88.511c1.643-69.4-17.651-123.977-58.046-162.647-13.679-13.096-29.954-24.431-48.98-33.797Zm101.023 270.41h87.726c-9.475 55.52-38.529 92.323-91.745 108.344 55.785 39.542 76.848 90.867 66.191 152.957l-44.391 184.981h-87.689l42.752-178.151c.149-.622.278-1.249.386-1.879 9.983-58.16-3.188-108.49-41.722-150.197 36.948-23.921 58.758-61.19 67.281-111.131.153-.894.263-1.79.332-2.685h.506c.126-.747.25-1.493.373-2.239Z" fill="#00a29a"></path><path d="M76.208 847.157c-36.752-5.562-64.959-37.32-64.959-75.614 0-42.21 34.269-76.478 76.478-76.478a76.45 76.45 0 0 1 20.676 2.832c32.178 9.028 55.802 38.6 55.802 73.646 0 42.209-34.268 76.478-76.478 76.478-3.915 0-7.761-.295-11.519-.864Zm56.524-262.05a77.324 77.324 0 0 1-6.804.299c-42.209 0-76.478-34.268-76.478-76.478 0-42.209 34.269-76.478 76.478-76.478 13.663 0 26.494 3.591 37.6 9.879 23.204 13.139 38.878 38.053 38.878 66.599 0 39.917-30.647 72.732-69.674 76.179Zm-18.148 84.136 11.77-54.569c58.168-.23 105.321-47.525 105.321-105.746 0-35.555-17.586-67.035-44.526-86.209H828.11c-9.475 55.52-38.529 92.323-91.745 108.344 55.784 39.542 76.848 90.867 66.191 152.957l-44.391 184.981H539.756l34.836-151.189c13.135-57.004-4.455-118.062-91.882-118.062H353.796l-71.217 274.677H112.245c46.557-11.07 81.229-52.96 81.229-102.884 0-49.085-33.515-90.403-78.89-102.3Zm-1.803-330.67 117.483-187.485h389.845c152.584 6.696 217.9 77.175 214.789 197.665H178.595v-10.18h-65.814Z" fill="#0086ff"></path></svg></a></div><div class="flex items-center gap-4 text-sm"><a class="hover:underline" href="/learn/">Learn</a><a class="hover:underline" href="https://cljdoc.org/d/no.cjohansen/replicant/">API Reference</a><div class="w-6"><a href="https://clojurians.slack.com/archives/C06JZ4X334N" title="Replicant on the Clojurians Slack"><svg style="display: inline-block; line-height: 1;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><path d="M80,56h24a0,0,0,0,1,0,0v72a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24V80A24,24,0,0,1,80,56Z" transform="translate(184 24) rotate(90)" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M128,80H104A24,24,0,0,1,80,56h0a24,24,0,0,1,24-24h0a24,24,0,0,1,24,24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M152,32h24a0,0,0,0,1,0,0v72a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24V56a24,24,0,0,1,24-24Z" transform="translate(304 160) rotate(-180)" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M176,128V104a24,24,0,0,1,24-24h0a24,24,0,0,1,24,24h0a24,24,0,0,1-24,24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M176,104h24a0,0,0,0,1,0,0v72a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24V128a24,24,0,0,1,24-24Z" transform="translate(24 328) rotate(-90)" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M128,176h24a24,24,0,0,1,24,24h0a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M104,128h24a0,0,0,0,1,0,0v72a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24V152a24,24,0,0,1,24-24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path><path d="M80,128v24a24,24,0,0,1-24,24h0a24,24,0,0,1-24-24h0a24,24,0,0,1,24-24Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path></svg></a></div><div class="w-6"><a href="https://github.com/cjohansen/replicant" title="Replicant on Github"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"></path></svg></a></div></div></div><div class="p-4 bg-base-200 items-center flex flex-row gap-4 sticky top-0 z-10"><button popovertarget="menu"><svg style="display: inline-block; line-height: 1; height: 24; width: 24;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><line stroke="currentColor" fill="none" stroke-linejoin="round" y1="128" stroke-linecap="round" stroke-width="16" x1="40" y2="128" x2="216"></line><line stroke="currentColor" fill="none" stroke-linejoin="round" y1="64" stroke-linecap="round" stroke-width="16" x1="40" y2="64" x2="216"></line><line stroke="currentColor" fill="none" stroke-linejoin="round" y1="192" stroke-linecap="round" stroke-width="16" x1="40" y2="192" x2="216"></line></svg></button><div id="menu" class="bg-base-200 m-0 px-0 absolute h-full" popover="auto"><aside class="basis-60 shrink-0"><h3 class="text-whitish mb-2 ml-4">Guides</h3><nav class="mb-8"><ol><li><a class="menu-item" href="/hiccup/">Hiccup<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/event-handlers/">Event handlers<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/life-cycle-hooks/">Life-cycle hooks<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/keys/">Keys<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/nil/">Explicit nils<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/alias/">Aliases<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li></ol></nav><h3 class="text-whitish mb-2 ml-4">Tutorials</h3><nav class="mb-8"><ol><li><a class="menu-item" href="/tutorials/tic-tac-toe/">Tic-Tac-Toe<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/routing/">Data-driven routing<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/state-atom/">State management with atoms<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/state-datascript/">State management with Datascript<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/network/">Backend APIs and network<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/network-reads/">Data-driven queries<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/network-writes/">Data-driven commands<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/tutorials/tic-tac-toe-alias/">Tic-Tac-Toe with aliases<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><span class="menu-item menu-item-selected">Alias powered i18n<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></span></li><li><a class="menu-item" href="/tutorials/sortable-table/">A sortable table alias<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li></ol></nav><h3 class="text-whitish mb-2 ml-4">Articles</h3><nav class="mb-8"><ol><li><a class="menu-item" href="/top-down/">Top-down rendering<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li><li><a class="menu-item" href="/learn/">Learn Replicant<svg style="display: inline-block; line-height: 1; height: 16; width: 16;" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><polyline points="96 48 176 128 96 208" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg></a></li></ol></nav></aside></div>Tutorial: Alias powered i18n</div><main class="mt-8 mb-16 mx-4 md:mx-0 fullscreen"><h1 class="h1 dark:text-whitish section-md">Alias powered i18n</h1><div class="prose mt-4 section-md"><p>In this tutorial we will use <a href="/alias/">aliases</a> to introduce an i18n element
to Replicant’s hiccup dialect, by integrating the
<a href="https://github.com/cjohansen/m1p">m1p library</a>.</p>
</div><div class="prose mt-4 section-md"><h2 id="m1p" class="h2 section-md"><a class="group relative" href="#m1p"><span class="absolute -left-4 group-hover:visible invisible">§ </span>m1p at a glance</a></h2><p><a href="https://github.com/cjohansen/m1p">m1p</a> is a data interpolation library that can
be used as a DIY i18n toolkit. m1p dictionaries are maps from keywords to
arbitrary Clojure data. The values may refer to parameters that will be provided
at lookup time.</p>
<p>Let’s see an example:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">m1p.core</span> <span class="ss">:as</span> <span class="nv">m1p</span><span class="p">])</span>

<span class="p">(</span><span class="k">def </span><span class="nv">dictionary</span>
  <span class="p">(</span><span class="nf">m1p/prepare-dictionary</span> <span class="c1">;; 1</span>
   <span class="p">{</span><span class="ss">:header/title</span> <span class="p">[</span><span class="ss">:fn/str</span> <span class="s">"Hello, {{:greetee}}!"</span><span class="p">]}))</span>

<span class="p">(</span><span class="nf">m1p/lookup</span> <span class="p">{}</span> <span class="nv">dictionary</span> <span class="ss">:header/title</span> <span class="p">{</span><span class="ss">:greetee</span> <span class="s">"Internet"</span><span class="p">})</span> <span class="c1">;; 2</span>

<span class="c1">;;=&gt; "Hello, Internet!"</span>
</code></pre>
<ol>
<li>While dictionaries are just maps, <code>prepare-dictionary</code> converts it to a
structure that allows better performance during lookups.</li>
<li>The last argument to <code>lookup</code> is a map of parameters that can be referred by
the value in the dictionary.</li>
</ol>
<p>Since m1p dictionaries can contain arbitrary data, they can also contain hiccup.</p>
</div><div class="prose mt-4 section-md"><h2 id="goal" class="h2 section-md"><a class="group relative" href="#goal"><span class="absolute -left-4 group-hover:visible invisible">§ </span>The goal</a></h2><p>The goal for this tutorial is to be able to make m1p-powered i18n lookups in
hiccup, e.g.:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">render-header</span> <span class="p">[{</span><span class="ss">:user/keys</span> <span class="p">[</span><span class="nv">given-name</span><span class="p">]}]</span>
  <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="ss">:i18n/k</span> <span class="p">{</span><span class="ss">:greetee</span> <span class="nv">given-name</span><span class="p">}</span> <span class="ss">::greeting</span><span class="p">]])</span>
</code></pre>
<p>The key and parameters have now switched positions. This plays well into
Replicant’s idea of what <a href="/hiccup/">hiccup</a> is – a vector with a keyword, an
optional map, and some children. In other words, designing the alias this way
means we can make lookups without arguments like this:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">[</span><span class="ss">:i18n/k</span> <span class="ss">::status-message</span><span class="p">]</span>
</code></pre>
</div><div class="prose mt-4 section-md"><h2 id="implementing-the-alias" class="h2 section-md"><a class="group relative" href="#implementing-the-alias"><span class="absolute -left-4 group-hover:visible invisible">§ </span>Implementing the alias</a></h2><p>If you want to follow along, check out the <a href="https://github.com/cjohansen/replicant-m1p-tutorial/releases/tag/setup">setup
tag</a>
from the tutorial’s github repo.</p>
<p>For starters, we will use a static dictonary and establish that we’re able to
make the m1p lookup with Replicant hiccup. Create <code>src/replicant_i18n/i18n.cljc</code>
with the following:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">replicant-i18n.i18n</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">m1p.core</span> <span class="ss">:as</span> <span class="nv">m1p</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant.alias</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defalias</span><span class="p">]]))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">dictionary</span>
  <span class="p">(</span><span class="nf">m1p/prepare-dictionary</span>
   <span class="p">{</span><span class="ss">:page/title</span> <span class="s">"Welcome!"</span>
    <span class="ss">:user/greeting</span> <span class="p">[</span><span class="ss">:fn/str</span> <span class="s">"Nice to see you, {{:user/given-name}}!"</span><span class="p">]}))</span>

<span class="p">(</span><span class="nf">defalias</span> <span class="nv">k</span> <span class="p">[</span><span class="nv">params</span> <span class="p">[</span><span class="nv">k</span><span class="p">]]</span>
  <span class="p">(</span><span class="nf">m1p/lookup</span> <span class="p">{}</span> <span class="nv">dictionary</span> <span class="nv">k</span> <span class="nv">params</span><span class="p">))</span>
</code></pre>
<p>We can verify that this works from another namespace:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">replicant-i18n.i18n</span> <span class="ss">:as</span> <span class="nv">i18n</span><span class="p">])</span>
<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">replicant.string</span> <span class="ss">:as</span> <span class="nv">rs</span><span class="p">])</span>

<span class="p">(</span><span class="nf">rs/render</span> <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:page/title</span><span class="p">]])</span>
<span class="c1">;;=&gt; "&lt;h1&gt;Welcome!&lt;/h1&gt;"</span>
</code></pre>
<h3>Different tongues</h3>
<p>This is great and all, but it’s not a real i18n solution yet. At the very least,
there should be more than one language. Let’s add another dictionary. While
we’re at it, let’s move the dictionaries to a separate namespace.</p>
<p>Create <code>src/replicant_i18n/i18n/nb.cljc</code> with:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">replicant-i18n.i18n.nb</span><span class="p">)</span>

<span class="p">(</span><span class="k">def </span><span class="nv">dictionary</span>
  <span class="p">{</span><span class="ss">:page/title</span> <span class="s">"Velkommen!"</span>
   <span class="ss">:user/greeting</span> <span class="p">[</span><span class="ss">:fn/str</span> <span class="s">"Hyggelig å se deg, {{:user/given-name}}!"</span><span class="p">]})</span>
</code></pre>
<p>Then create <code>src/replicant_i18n/i18n/en.cljc</code> with:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">replicant-i18n.i18n.en</span><span class="p">)</span>

<span class="p">(</span><span class="k">def </span><span class="nv">dictionary</span>
  <span class="p">{</span><span class="ss">:page/title</span> <span class="s">"Welcome!"</span>
     <span class="ss">:user/greeting</span> <span class="p">[</span><span class="ss">:fn/str</span> <span class="s">"Nice to see you, {{:user/given-name}}!"</span><span class="p">]})</span>
</code></pre>
<p>Then update the dictionaries definition in <code>replicant-i18n.i18n</code> to:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">replicant-i18n.i18n</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">m1p.core</span> <span class="ss">:as</span> <span class="nv">m1p</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant.alias</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defalias</span><span class="p">]]</span>
            <span class="p">[</span><span class="nv">replicant-i18n.i18n.nb</span> <span class="ss">:as</span> <span class="nv">nb</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant-i18n.i18n.en</span> <span class="ss">:as</span> <span class="nv">en</span><span class="p">]))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">dictionaries</span>
  <span class="p">(</span><span class="nb">-&gt; </span><span class="p">{</span><span class="ss">:nb</span> <span class="nv">nb/dictionary</span>
       <span class="ss">:en</span> <span class="nv">en/dictionary</span><span class="p">}</span>
      <span class="p">(</span><span class="nf">update-vals</span> <span class="nv">m1p/prepare-dictionary</span><span class="p">)))</span>
</code></pre>
<p>Now we need to adjust the alias as well - it will need to know the locale to
make a lookup. We’ll start by making the locale explicit in the lookup, and
investigate our options later:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">defalias</span> <span class="nv">k</span> <span class="p">[</span><span class="nv">params</span> <span class="p">[</span><span class="nv">locale</span> <span class="nv">k</span><span class="p">]]</span>
  <span class="p">(</span><span class="nf">m1p/lookup</span> <span class="p">{}</span> <span class="p">(</span><span class="nb">get </span><span class="nv">dictionaries</span> <span class="nv">locale</span><span class="p">)</span> <span class="nv">k</span> <span class="nv">params</span><span class="p">))</span>
</code></pre>
<p>Now we can use our multi-lingual i18n alias like so:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">replicant-i18n.i18n</span> <span class="ss">:as</span> <span class="nv">i18n</span><span class="p">])</span>
<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">replicant.string</span> <span class="ss">:as</span> <span class="nv">rs</span><span class="p">])</span>

<span class="p">(</span><span class="nf">rs/render</span> <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:nb</span> <span class="ss">:page/title</span><span class="p">]])</span>
<span class="c1">;;=&gt; "&lt;h1&gt;Velkommen!&lt;/h1&gt;"</span>
<span class="p">(</span><span class="nf">rs/render</span> <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:en</span> <span class="ss">:page/title</span><span class="p">]])</span>
<span class="c1">;;=&gt; "&lt;h1&gt;Welcome!&lt;/h1&gt;"</span>
</code></pre>
<h3>Loosely coupled dictionaries</h3>
<p>If we wanted to provide the <code>i18n/k</code> alias as a library, it’s quite unfortunate
that it is directly referencing the dictionaries. Ideally, the alias should work
with user-provided dictionaries. But we probably don’t want to pass the
dictionaries around the entire UI – after all, dictionaries are static data at
runtime.</p>
<p>Static data is exactly what Replicant’s <a href="/alias/#alias-data">alias data</a> was
made to support. Let’s make an adjustment to the alias definition:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">replicant-i18n.i18n</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">m1p.core</span> <span class="ss">:as</span> <span class="nv">m1p</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant.alias</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defalias</span><span class="p">]]))</span>

<span class="p">(</span><span class="nf">defalias</span> <span class="nv">k</span> <span class="p">[</span><span class="nv">params</span> <span class="p">[</span><span class="nv">locale</span> <span class="nv">k</span><span class="p">]]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">dictionary</span> <span class="p">(</span><span class="nb">-&gt; </span><span class="p">(</span><span class="ss">:replicant/alias-data</span> <span class="nv">params</span><span class="p">)</span>
                       <span class="ss">:dictionaries</span>
                       <span class="p">(</span><span class="nb">get </span><span class="nv">locale</span><span class="p">))])</span>
  <span class="p">(</span><span class="nf">m1p/lookup</span> <span class="p">{}</span> <span class="nv">dictionary</span> <span class="nv">k</span> <span class="nv">params</span><span class="p">))</span>
</code></pre>
<p>Now the alias no longer has an explicit dependency on the dictionaries. Instead,
we’ll have to pass them as <code>:alias-data</code> when rendering:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">replicant-i18n.core</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">replicant-i18n.i18n</span> <span class="ss">:as</span> <span class="nv">i18n</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant.string</span> <span class="ss">:as</span> <span class="nv">rs</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant-i18n.i18n.nb</span> <span class="ss">:as</span> <span class="nv">nb</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant-i18n.i18n.en</span> <span class="ss">:as</span> <span class="nv">en</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">m1p.core</span> <span class="ss">:as</span> <span class="nv">m1p</span><span class="p">]))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">dictionaries</span>
  <span class="p">(</span><span class="nb">-&gt; </span><span class="p">{</span><span class="ss">:nb</span> <span class="nv">nb/dictionary</span>
       <span class="ss">:en</span> <span class="nv">en/dictionary</span><span class="p">}</span>
      <span class="p">(</span><span class="nf">update-vals</span> <span class="nv">m1p/prepare-dictionary</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">comment</span>
  <span class="p">(</span><span class="nf">rs/render</span> <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:nb</span> <span class="ss">:page/title</span><span class="p">]]</span>
             <span class="p">{</span><span class="ss">:alias-data</span> <span class="p">{</span><span class="ss">:dictionaries</span> <span class="nv">dictionaries</span><span class="p">}})</span>
  <span class="c1">;;=&gt; "&lt;h1&gt;Velkommen!&lt;/h1&gt;"</span>
  <span class="p">(</span><span class="nf">rs/render</span> <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:en</span> <span class="ss">:page/title</span><span class="p">]]</span>
             <span class="p">{</span><span class="ss">:alias-data</span> <span class="p">{</span><span class="ss">:dictionaries</span> <span class="nv">dictionaries</span><span class="p">}})</span>
  <span class="c1">;;=&gt; "&lt;h1&gt;Welcome!&lt;/h1&gt;"</span>
<span class="p">)</span>
</code></pre>
<p>Note that this works exactly the same for frontend rendering with
<code>replicant.dom</code>, e.g.:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">replicant.dom</span> <span class="ss">:as</span> <span class="nv">r</span><span class="p">])</span>

<span class="p">(</span><span class="nf">r/render</span> <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:nb</span> <span class="ss">:page/title</span><span class="p">]]</span>
          <span class="p">{</span><span class="ss">:alias-data</span> <span class="p">{</span><span class="ss">:dictionaries</span> <span class="nv">dictionaries</span><span class="p">}})</span>
</code></pre>
<p>Passing dictionaries to <code>:alias-data</code> means we don’t have to pass it through all
the functions that produce hiccup for the UI. It’s worth noting that if the
dictionaries change, Replicant will re-render the entire UI. This will only
happen at runtime during development, so should be fine.</p>
</div><div class="prose mt-4 section-md"><h2 id="locale" class="h2 section-md"><a class="group relative" href="#locale"><span class="absolute -left-4 group-hover:visible invisible">§ </span>Implicit locale</a></h2><p>The solution we have so far uses an explicit locale. This is nice and
predictable, if a little cumbersome. In practice you will end up passing the
locale around “everywhere”. What concessions do we have to make to have an
implicit locale?</p>
<p>As we just learned, we can pass the locale along with the dictionaries as
<code>:alias-data</code>:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">replicant-i18n.i18n</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">m1p.core</span> <span class="ss">:as</span> <span class="nv">m1p</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant.alias</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defalias</span><span class="p">]]))</span>

<span class="p">(</span><span class="nf">defalias</span> <span class="nv">k</span> <span class="p">[</span><span class="nv">params</span> <span class="p">[</span><span class="nv">k</span><span class="p">]]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">dictionaries</span> <span class="nv">locale</span><span class="p">]}</span> <span class="p">(</span><span class="ss">:replicant/alias-data</span> <span class="nv">params</span><span class="p">)]</span>
    <span class="p">(</span><span class="nf">m1p/lookup</span> <span class="p">{}</span> <span class="p">(</span><span class="nb">get </span><span class="nv">dictionaries</span> <span class="nv">locale</span><span class="p">)</span> <span class="nv">k</span> <span class="nv">params</span><span class="p">)))</span>
</code></pre>
<p>With this change, locales are implicit, and none of our hiccup-making functions
need to know about it:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="nf">rs/render</span> <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:page/title</span><span class="p">]]</span>
           <span class="p">{</span><span class="ss">:alias-data</span> <span class="p">{</span><span class="ss">:dictionaries</span> <span class="nv">dictionaries</span>
                         <span class="ss">:locale</span> <span class="ss">:nb</span><span class="p">}})</span>
<span class="c1">;;=&gt; "&lt;h1&gt;Velkommen!&lt;/h1&gt;"</span>

<span class="p">(</span><span class="nf">rs/render</span> <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:page/title</span><span class="p">]]</span>
           <span class="p">{</span><span class="ss">:alias-data</span> <span class="p">{</span><span class="ss">:dictionaries</span> <span class="nv">dictionaries</span>
                         <span class="ss">:locale</span> <span class="ss">:en</span><span class="p">}})</span>
<span class="c1">;;=&gt; "&lt;h1&gt;Welcome!&lt;/h1&gt;"</span>
</code></pre>
<p>This is a pretty big win, as the UI can talk about text strings in the abstract
using our alias, and don’t even need to care about the current locale.</p>
<p>What are the drawbacks of this approach? Since the locale now is part of
<code>:alias-data</code>, Replicant will re-render the entire UI when it changes. In most
cases this is not a big loss. Changing locales is a rare occurrence, and
unlikely to happen halway through filling out a form (a full re-render
means lost state, including in input fields). Whether or not this trade-off is
acceptable is up to you. If you want to transition translations in your UI, you
will have to work with an explicit locale.</p>
</div><div class="prose mt-4 section-md"><h2 id="why" class="h2 section-md"><a class="group relative" href="#why"><span class="absolute -left-4 group-hover:visible invisible">§ </span>But why?</a></h2><p>You might wonder what we gained from all this. You could just use m1p and call
<code>lookup</code> everywhere we used the <code>i18n/k</code> alias. The benefits are pretty much the
same as the ones mentioned in the <a href="/alias/">aliases guide</a>:</p>
<ul>
<li><a href="/alias/#late-bound">Late bound</a>: The i18n alias only re-evaluates whenever
you change the key or one of its parameters.</li>
<li><a href="/alias/#abstraction-level">Raised abstraction level</a>: <code>[i18n/k user :user/greeting]</code> communicates the intention of welcoming the user, while
“Welcome Christian!” is a very specific formulation. Being able to test this
intention without getting hung up on the detais is a major benefit.</li>
</ul>
</div><div class="prose mt-4 section-md"><h2 id="code-listing" class="h2 section-md"><a class="group relative" href="#code-listing"><span class="absolute -left-4 group-hover:visible invisible">§ </span>Final code-listing</a></h2><p>Here is a small UI that makes use of our newly created alias and the
dictionaries. See the <a href="https://github.com/cjohansen/replicant-m1p-tutorial">tutorial
repo</a> for the full details:</p>
<pre class="codehilite"><code class="language-clj"><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">replicant-i18n.core</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">m1p.core</span> <span class="ss">:as</span> <span class="nv">m1p</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant-i18n.i18n</span> <span class="ss">:as</span> <span class="nv">i18n</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant-i18n.i18n.en</span> <span class="ss">:as</span> <span class="nv">en</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant-i18n.i18n.nb</span> <span class="ss">:as</span> <span class="nv">nb</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">replicant.dom</span> <span class="ss">:as</span> <span class="nv">r</span><span class="p">]))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">dictionaries</span>
  <span class="p">(</span><span class="nb">-&gt; </span><span class="p">{</span><span class="ss">:nb</span> <span class="nv">nb/dictionary</span>
       <span class="ss">:en</span> <span class="nv">en/dictionary</span><span class="p">}</span>
      <span class="p">(</span><span class="nf">update-vals</span> <span class="nv">m1p/prepare-dictionary</span><span class="p">)))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">render-ui</span> <span class="p">[</span><span class="nv">user</span><span class="p">]</span>
  <span class="p">[</span><span class="ss">:div</span>
   <span class="p">[</span><span class="ss">:h1</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:page/title</span><span class="p">]]</span>
   <span class="p">[</span><span class="ss">:p</span> <span class="p">[</span><span class="nv">i18n/k</span> <span class="nv">user</span> <span class="ss">:user/greeting</span><span class="p">]]</span>
   <span class="p">[</span><span class="ss">:button</span> <span class="p">{</span><span class="ss">:on</span> <span class="p">{</span><span class="ss">:click</span> <span class="p">[</span><span class="ss">:switch-locale</span><span class="p">]}}</span>
    <span class="p">[</span><span class="nv">i18n/k</span> <span class="ss">:locale/switch</span><span class="p">]]])</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">render</span> <span class="p">[</span><span class="nv">state</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">r/render</span>
   <span class="p">(</span><span class="nf">js/document.getElementById</span> <span class="s">"app"</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">render-ui</span> <span class="p">{</span><span class="ss">:user/given-name</span> <span class="s">"Christian"</span><span class="p">})</span>
   <span class="p">{</span><span class="ss">:alias-data</span>
    <span class="p">{</span><span class="ss">:dictionaries</span> <span class="nv">dictionaries</span>
     <span class="ss">:locale</span> <span class="p">(</span><span class="ss">:locale</span> <span class="nv">state</span><span class="p">)}}))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">other-locale</span>
  <span class="p">{</span><span class="ss">:en</span> <span class="ss">:nb</span>
   <span class="ss">:nb</span> <span class="ss">:en</span><span class="p">})</span>

<span class="p">(</span><span class="k">def </span><span class="nv">store</span> <span class="p">(</span><span class="nf">atom</span> <span class="p">{}))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">main</span> <span class="p">[]</span>
  <span class="p">(</span><span class="nf">r/set-dispatch!</span>
   <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">_</span> <span class="nv">_</span><span class="p">]</span>
     <span class="p">(</span><span class="nf">swap!</span> <span class="nv">store</span> <span class="nv">update</span> <span class="ss">:locale</span> <span class="nv">other-locale</span><span class="p">)))</span>

  <span class="p">(</span><span class="nf">add-watch</span> <span class="nv">store</span> <span class="ss">::render</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">_</span> <span class="nv">_</span> <span class="nv">_</span> <span class="nv">state</span><span class="p">]</span> <span class="p">(</span><span class="nf">render</span> <span class="nv">state</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">swap!</span> <span class="nv">store</span> <span class="nb">assoc </span><span class="ss">:locale</span> <span class="ss">:en</span><span class="p">))</span>
</code></pre>
</div></main><script type="text/javascript" src="/bundles/d399b4851ce7/app.js"></script></body></html>